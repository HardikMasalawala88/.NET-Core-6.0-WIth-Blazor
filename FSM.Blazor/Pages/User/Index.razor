@namespace FSM.Blazor.Pages.User
@using FSM.Blazor.Data.User
@using DataModels.VM.User
@using Configuration;
@inject UserService UserService
@layout MainLayout
@inject DialogService DialogService


@page "/User"


<div class="row mb-4">
    <div class="col">
        <h1 style="float:left">Company</h1>
        <RadzenButton Style="float:right" Text="Add New" Icon="add_circle_outline" ButtonStyle="ButtonStyle.Primary" Click=@(() => UseCreateDialog(new UserDataVM())) />
    </div>
</div>

<RadzenDataGrid AllowFiltering="true" @ref="grid" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                FilterMode="FilterMode.Simple" AllowPaging="true" IsLoading="@isLoading"
                PageSize="Configuration.ConfigurationSettings.Instance.BlazorGridDefaultPagesize"
                AllowSorting="true" Data="@data" TItem="UserDataVM"
                PageSizeOptions="Configuration.ConfigurationSettings.Instance.BlazorGridPagesizeOptions"
                Count="@count" LoadData="@LoadData">
    <Columns>

        <RadzenDataGridColumn Width="50px" TItem="UserDataVM" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
            <Template Context="value">
                @(data.IndexOf(value) + 1)
            </Template>
        </RadzenDataGridColumn>

        <RadzenDataGridColumn TItem="UserDataVM" Property="FirstName" Title="First Name"></RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="UserDataVM" Filterable="false" Sortable="false" Property="LastName" Title="Last Name"></RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="UserDataVM" Filterable="false" Sortable="false" Property="Email" Title="Email"></RadzenDataGridColumn>

        <RadzenDataGridColumn TextAlign="TextAlign.Center" Width="160px" Sortable="false" Filterable="false" TItem="UserDataVM" Property="Id" Title="Order Details">
            <Template Context="data">
                <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="mode_edit" Class="m-1" Click=@(() => UseCreateDialog(data)) />
                <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete_sweep" Class="m-1"
                              Click=@(args => OpenDeleteDialog(data)) />
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

@{
    async Task OpenDeleteDialog(UserDataVM userDataVM)
    {
        var result = await DialogService.OpenAsync("Delete", ds =>
    @<div>
        <p class="mb-4">Are you sure, You want to delete <b> @userDataVM.FirstName + " " + @userDataVM.LastName </b>?</p>
        <div class="row" style="text-align:right">
            <div class="col">
                <RadzenButton Text="Yes" ButtonStyle="ButtonStyle.Danger" Click="() => DeleteAsync(userDataVM.Id) " Class="mr-1" Style="width: 80px;" />
                <RadzenButton Text="No" Click="() => ds.Close(false)" ButtonStyle="ButtonStyle.Secondary" Class="mr-1" Style="width: 80px;" />

            </div>
        </div>
    </div>
    , new DialogOptions { Width = "360px" });

    }
}